<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="杨航"><title>docker入门指南 · 杨航的博客</title><meta name="description" content="1 概述1.1 什么是docker1.2 docker优点1.不需要安装操作系统，秒级启动，可充分利用服务器资源
2.方便部署
1.3 公司准备使用场景1.3.1 搭建演示环境
将程序统一打包至一个镜像中统一打包，方便

1.3.2 搭建开发测试环境
在公司搭建私有镜像仓库。创建公共镜像源，如：to"><meta name="keywords"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo@2x.png" style="width:127px;"><h3 title=""><a href="/">杨航的博客</a></h3><div class="description"><p>所有的伟大，都源于一个勇敢的开始。</p></div></div></div><ul class="social-links"></ul><div class="footer"><a target="_blank" href="/"><span>Theme by </span></a><a href="https://www.caicai.me"> CaiCai </a><span>&</span><a href="https://github.com/Ben02/hexo-theme-Anatole"> Ben</a><div class="by_farbox"><a href="https://hexo.io/zh-cn/" target="_blank">Proudly published with Hexo&#65281;</a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">首页</a></li><li><a href="/about">关于</a></li><li><a href="/archives">归档</a></li><li><a href="/links">友链</a></li></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li></div><div class="avatar"><img></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>docker入门指南</a></h3></div><div class="post-content"><h3 id="1-概述"><a href="#1-概述" class="headerlink" title="1 概述"></a>1 概述</h3><h4 id="1-1-什么是docker"><a href="#1-1-什么是docker" class="headerlink" title="1.1 什么是docker"></a>1.1 什么是docker</h4><h4 id="1-2-docker优点"><a href="#1-2-docker优点" class="headerlink" title="1.2 docker优点"></a>1.2 docker优点</h4><pre><code>1.不需要安装操作系统，秒级启动，可充分利用服务器资源
2.方便部署
</code></pre><h4 id="1-3-公司准备使用场景"><a href="#1-3-公司准备使用场景" class="headerlink" title="1.3 公司准备使用场景"></a>1.3 公司准备使用场景</h4><h5 id="1-3-1-搭建演示环境"><a href="#1-3-1-搭建演示环境" class="headerlink" title="1.3.1 搭建演示环境"></a>1.3.1 搭建演示环境</h5><blockquote>
<p>将程序统一打包至一个镜像中统一打包，方便</p>
</blockquote>
<h5 id="1-3-2-搭建开发测试环境"><a href="#1-3-2-搭建开发测试环境" class="headerlink" title="1.3.2 搭建开发测试环境"></a>1.3.2 搭建开发测试环境</h5><blockquote>
<p>在公司搭建私有镜像仓库。创建公共镜像源，如：tomcat+jdk镜像、zabbix镜像、jdk镜像、vsftp镜像</p>
</blockquote>
<h5 id="1-3-3-搭建生产环境"><a href="#1-3-3-搭建生产环境" class="headerlink" title="1.3.3 搭建生产环境"></a>1.3.3 搭建生产环境</h5><blockquote>
<p>在公司生成产品镜像。使用docker export 导出至生产环境中，生产环境使用docker import 导入。</p>
</blockquote>
<h3 id="2-docker-安装"><a href="#2-docker-安装" class="headerlink" title="2 docker 安装"></a>2 docker 安装</h3><h4 id="2-1-centos7"><a href="#2-1-centos7" class="headerlink" title="2.1 centos7"></a>2.1 centos7</h4><blockquote>
<p>由于docker已经放在centos7的extra源内，因此可直接使用yum进行安装配置。</p>
</blockquote>
<h5 id="2-1-1-安装"><a href="#2-1-1-安装" class="headerlink" title="2.1.1 安装"></a>2.1.1 安装</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install docker</span><br></pre></td></tr></table></figure>
<h5 id="2-1-2-修改docker存储目录"><a href="#2-1-2-修改docker存储目录" class="headerlink" title="2.1.2 修改docker存储目录"></a>2.1.2 修改docker存储目录</h5><blockquote>
<p>修改配置文件/etc/sysconfig/docker<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">OPTIONS=&apos;--graph=/data/docker --selinux-enabled --log-driver=journald --signature-verification=false&apos;</span><br><span class="line">注：--graph=/data/docker即为修改docker默认路径</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h5 id="2-1-3-配置docker镜像加速器"><a href="#2-1-3-配置docker镜像加速器" class="headerlink" title="2.1.3 配置docker镜像加速器"></a>2.1.3 配置docker镜像加速器</h5><blockquote>
<p>镜像加速器有利于快速下载镜像,修改如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@node249 tomcat8_jre8_supervisor]# cat /etc/docker/daemon.json</span><br><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;https://docker.mirrors.ustc.edu.cn&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h5 id="2-1-4-启停服务-amp-开机自启动"><a href="#2-1-4-启停服务-amp-开机自启动" class="headerlink" title="2.1.4 启停服务&amp;开机自启动"></a>2.1.4 启停服务&amp;开机自启动</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">重新加载配置文件：systemctl daemon-reload</span><br><span class="line">启动：systemctl start docker.service</span><br><span class="line">停止：systemctl stop docker.service</span><br><span class="line">开机自启动：systemctl enable docker.service</span><br></pre></td></tr></table></figure>
<h3 id="3-镜像操作"><a href="#3-镜像操作" class="headerlink" title="3 镜像操作"></a>3 镜像操作</h3><h4 id="3-1-搜索镜像"><a href="#3-1-搜索镜像" class="headerlink" title="3.1 搜索镜像"></a>3.1 搜索镜像</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker search centos</span><br></pre></td></tr></table></figure>
<h4 id="3-2-获取镜像"><a href="#3-2-获取镜像" class="headerlink" title="3.2 获取镜像"></a>3.2 获取镜像</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker push docker.io/centos</span><br></pre></td></tr></table></figure>
<h4 id="3-3-删除镜像"><a href="#3-3-删除镜像" class="headerlink" title="3.3 删除镜像"></a>3.3 删除镜像</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rmi docker.io/centos</span><br></pre></td></tr></table></figure>
<h4 id="3-4-制作镜像"><a href="#3-4-制作镜像" class="headerlink" title="3.4 制作镜像"></a>3.4 制作镜像</h4><h5 id="3-4-1-制作tomcat镜像"><a href="#3-4-1-制作tomcat镜像" class="headerlink" title="3.4.1 制作tomcat镜像"></a>3.4.1 制作tomcat镜像</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"># 目录结构</span><br><span class="line">[root@node249 tomcat8-jre8]# pwd</span><br><span class="line">/data/images/tomcat8-jre8</span><br><span class="line">[root@node249 tomcat8-jre8]# tree -L 2</span><br><span class="line">.</span><br><span class="line">├── Dockerfile</span><br><span class="line">├── java</span><br><span class="line">│   └── jre1.8.0_192</span><br><span class="line">└── tomcat</span><br><span class="line">    ├── bin</span><br><span class="line">    ├── conf</span><br><span class="line">    ├── lib</span><br><span class="line">    ├── LICENSE</span><br><span class="line">    ├── logs</span><br><span class="line">    ├── NOTICE</span><br><span class="line">    ├── RELEASE-NOTES</span><br><span class="line">    ├── RUNNING.txt</span><br><span class="line">    ├── temp</span><br><span class="line">    ├── webapps</span><br><span class="line">    └── work</span><br><span class="line"></span><br><span class="line">10 directories, 5 files</span><br><span class="line"># Dockerfile内容</span><br><span class="line">[root@node249 tomcat8-jre8]# cat Dockerfile </span><br><span class="line">#构建tomcat8基础镜像</span><br><span class="line">#引用基础镜像</span><br><span class="line">FROM docker.io/centos</span><br><span class="line">MAINTAINER yanghang &quot;yanghang0717@139.com&quot;</span><br><span class="line"></span><br><span class="line">#创建文件夹</span><br><span class="line">RUN mkdir -p /data/java</span><br><span class="line">RUN mkdir -p /data/tomcat</span><br><span class="line">#将容器时间和主机时间设成一致</span><br><span class="line">RUN cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime &amp;&amp; echo &apos;Asia/Shanghai&apos; &gt;/etc/timezone</span><br><span class="line">#把当前目录下的文件夹添加到镜像中</span><br><span class="line">ADD java /data/java</span><br><span class="line">ADD tomcat /data/tomcat</span><br><span class="line">#添加环境变量</span><br><span class="line">ENV CATALINA_HOME /data/tomcat</span><br><span class="line">ENV JAVA_HOME /data/java/jre1.8.0_192</span><br><span class="line">ENV PATH $CATALINA_HOME/bin:$JAVA_HOME/bin:$PATH</span><br><span class="line">WORKDIR $CATALINA_HOME</span><br><span class="line">#暴露8080端口</span><br><span class="line">EXPOSE 8080</span><br><span class="line"></span><br><span class="line">#启动时运行tomcat</span><br><span class="line">CMD [&quot;/usr/local/tomcat/bin/catalina.sh&quot;, &quot;run&quot;]</span><br><span class="line"></span><br><span class="line"># 制作tomcat镜像</span><br><span class="line">docker build -t tomcat8 .</span><br><span class="line">docker build -t centos7_zh .</span><br></pre></td></tr></table></figure>
<h4 id="3-4-2-制作jar镜像"><a href="#3-4-2-制作jar镜像" class="headerlink" title="3.4.2 制作jar镜像"></a>3.4.2 制作jar镜像</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=&quot;https://ae01.alicdn.com/kf/HTB1wl18aMZC2uNjSZFn761xZpXaU.png&quot;&gt;</span><br></pre></td></tr></table></figure>
<h3 id="4-容器操作"><a href="#4-容器操作" class="headerlink" title="4 容器操作"></a>4 容器操作</h3><h4 id="4-1-根据镜像创建容器"><a href="#4-1-根据镜像创建容器" class="headerlink" title="4.1 根据镜像创建容器"></a>4.1 根据镜像创建容器</h4><h5 id="4-1-1-创建tomcat容器"><a href="#4-1-1-创建tomcat容器" class="headerlink" title="4.1.1 创建tomcat容器"></a>4.1.1 创建tomcat容器</h5><blockquote>
<p>注:tomcat开发测试环境建议网络使用桥接网络，生产环境由于使用独立服务器，因此使用host网络模式。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 开发测试环境</span><br><span class="line">docker run -itd --restart=always -p 10001:8080 -v /data/mvtech/blxx_netmanager/tomcat/logs:/data/tomcat/logs -v /data/mvtech/blxx_netmanager/tomcat/webapps/ROOT:/data/tomcat/webapps/ROOT --privileged --name=blxx_netmanager tomcat8</span><br><span class="line"># 生产环境</span><br><span class="line">docker run -itd --restart=always --network host -v /data/mvtech/blxx_netmanager/tomcat/logs:/data/tomcat/logs -v /data/mvtech/blxx_netmanager/tomcat/webapps/ROOT:/data/tomcat/webapps/ROOT --privileged --name=blxx_netmanager tomcat8</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">docker run -itd --restart=always -p 10080:8080 -v /blxx/tomcat/logs:/data/tomcat/logs -v /blxx/tomcat/webapps/blxx_mobile:/data/tomcat/webapps/blxx_mobile --privileged --name=blxx_mobile centos7_zh_jdk8_tomcat8</span><br><span class="line"></span><br><span class="line">docker pull 192.168.2.249/library/centos7_zh_jdk8_tomcat8:v1.0</span><br><span class="line"></span><br><span class="line">docker run -itd --restart=always -p 10080:8080 -v /blxx/tomcat/logs:/data/tomcat/logs -v /blxx/tomcat/webapps/blxx_mobile:/data/tomcat/webapps/blxx_mobile --privileged --name=blxx_mobile 192.168.2.249/library/centos7_zh_jdk8_tomcat8:v1.0</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h5 id="4-1-2-创建vsftp容器"><a href="#4-1-2-创建vsftp容器" class="headerlink" title="4.1.2 创建vsftp容器"></a>4.1.2 创建vsftp容器</h5><blockquote>
<p>ftp镜像建议使用host网络模式，因为桥接模式会报错。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run  -d --restart=always --network host -v /data/ftp_root/:/home/vsftpd -e FTP_USER=mvtechftp -e FTP_PASS=mvtech123 --privileged --name mvtechftp docker.io/fauria/vsftpd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">docker run  -d --restart=always --network host -v /data/ftp_root/:/home/vsftpd --privileged --name vsftpd vsftpd</span><br><span class="line"></span><br><span class="line">docker pull 192.168.2.249/library/centos7-vsftpd:latest</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h4 id="4-1-3-创建jdk环境"><a href="#4-1-3-创建jdk环境" class="headerlink" title="4.1.3 创建jdk环境"></a>4.1.3 创建jdk环境</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -itd --restart=always --privileged --name=centos centos /bin/bash</span><br></pre></td></tr></table></figure>
<h4 id="4-1-4-创建centos容器"><a href="#4-1-4-创建centos容器" class="headerlink" title="4.1.4 创建centos容器"></a>4.1.4 创建centos容器</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">docker run -itd --restart=always --privileged --name=zabbix-server docker.io/centos /usr/sbin/init</span><br><span class="line"></span><br><span class="line">docker run -itd --restart=always --network host   --privileged -v /data/ftp_root/mvtechftp:/data/ftp_root/mvtechftp --privileged --name=vsftpd 192.168.2.249/library/centos7-vsftpd /usr/sbin/init</span><br><span class="line"></span><br><span class="line">docker run -itd --restart=always --network host   --privileged -v /data/ftp_root/mvtechftp:/data/ftp_root/mvtechftp --name=centos centos7-vsftpd /usr/sbin/init</span><br><span class="line">/data/ftp_root/mvtechftp</span><br><span class="line"></span><br><span class="line">docker run -itd --restart=always --network host  --privileged --name=zabbix2.4.8 centos7.5-zabbix2.4.8-zh_cn /usr/sbin/init</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">docker run -itd --restart=always --network host  --privileged --name=zabbix2.4.8 zabbix2.4.8 /usr/sbin/init</span><br><span class="line">docker run -itd --restart=always --network host  --privileged --name=centos7_zh centos7_zh /usr/sbin/init</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">docker pull 192.168.2.249/library/zabbix2.4.8:v1.0</span><br><span class="line"></span><br><span class="line">docker pull 192.168.2.249/library/centos</span><br><span class="line"></span><br><span class="line">docker run -itd --restart=always --network host  --privileged --name=zabbix2.4.8 192.168.2.249/library/zabbix2.4.8:v1.0 /usr/sbin/init</span><br><span class="line"></span><br><span class="line">docker run -itd --restart=always --network host  --privileged --name=centos_dw_crawler 192.168.2.249/library/centos /usr/sbin/init</span><br><span class="line"></span><br><span class="line">docker run -itd --restart=always --network host  --privileged --name=centos_zh 192.168.2.249/library/centos7_zh /usr/sbin/init</span><br><span class="line"></span><br><span class="line">进入容器内部</span><br><span class="line">docker exec -it zabbix2.4.8 /bin/bash</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">docker run -d --restart=always -p 3306:3306 -v /d/work/docker/mysql5.7.24:/data --privileged --name=mysql:5.7.24 192.168.2.249/library/mysql:5.7.24 /usr/sbin/init</span><br></pre></td></tr></table></figure>
<h4 id="4-2-查看容器详情"><a href="#4-2-查看容器详情" class="headerlink" title="4.2 查看容器详情"></a>4.2 查看容器详情</h4><p>docker inspect test</p>
<h4 id="4-3-查看容器日志"><a href="#4-3-查看容器日志" class="headerlink" title="4.3 查看容器日志"></a>4.3 查看容器日志</h4><p>docker logs -f -t –tail 10 test</p>
<h4 id="4-4-导出镜像"><a href="#4-4-导出镜像" class="headerlink" title="4.4 导出镜像"></a>4.4 导出镜像</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker export zabbix-server &gt; zabbix-server.tar</span><br></pre></td></tr></table></figure>
<h4 id="4-5-导入镜像"><a href="#4-5-导入镜像" class="headerlink" title="4.5 导入镜像"></a>4.5 导入镜像</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker import - za &lt; zabbix-server.tar</span><br><span class="line">docker import http://192.168.2.253/file/zabbix-server.tar zabbix2.4.8</span><br></pre></td></tr></table></figure>
<h3 id="5-搭建Harbor企业级docker仓库"><a href="#5-搭建Harbor企业级docker仓库" class="headerlink" title="5 搭建Harbor企业级docker仓库"></a>5 搭建Harbor企业级docker仓库</h3><h4 id="5-1-环境准备"><a href="#5-1-环境准备" class="headerlink" title="5.1 环境准备"></a>5.1 环境准备</h4><h5 id="5-1-1-安装docker"><a href="#5-1-1-安装docker" class="headerlink" title="5.1.1 安装docker"></a>5.1.1 安装docker</h5><blockquote>
<p>请参考第2章 安装docker</p>
</blockquote>
<h5 id="5-1-2-安装docker-compose"><a href="#5-1-2-安装docker-compose" class="headerlink" title="5.1.2 安装docker-compose"></a>5.1.2 安装docker-compose</h5><blockquote>
<p>注：操作系统不自带pip 请自行安装<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install docker-compose</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h5 id="5-1-3-下载harbor"><a href="#5-1-3-下载harbor" class="headerlink" title="5.1.3 下载harbor"></a>5.1.3 下载harbor</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">url地址：https://github.com/goharbor/harbor/releases</span><br><span class="line">选择所需版本。我所下载的为：harbor-online-installer-v1.6.0.tgz</span><br><span class="line">tar -zxf /root/harbor-online-installer-v1.6.0.tgz -C /usr/local/</span><br></pre></td></tr></table></figure>
<h5 id="5-1-4-修改配置文件harbor-cfg"><a href="#5-1-4-修改配置文件harbor-cfg" class="headerlink" title="5.1.4 修改配置文件harbor.cfg"></a>5.1.4 修改配置文件harbor.cfg</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hostname = 192.168.2.46 </span><br><span class="line">harbor_admin_password = mvtech123</span><br><span class="line">self_registration = off</span><br><span class="line">project_creation_restriction = adminonly</span><br></pre></td></tr></table></figure>
<h5 id="5-1-5-安装前检查"><a href="#5-1-5-安装前检查" class="headerlink" title="5.1.5 安装前检查"></a>5.1.5 安装前检查</h5><center><img src="https://i.loli.net/2018/10/23/5bceaded63c1f.png" alt="04.png" title="04.png"></center>

<h4 id="5-2-安装harbor"><a href="#5-2-安装harbor" class="headerlink" title="5.2 安装harbor"></a>5.2 安装harbor</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line">[root@harbor ~]# /usr/local/harbor/install.sh </span><br><span class="line"></span><br><span class="line">[Step 0]: checking installation environment ...</span><br><span class="line"></span><br><span class="line">Note: docker version: 1.13.1</span><br><span class="line"></span><br><span class="line">Note: docker-compose version: 1.22.0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[Step 1]: preparing environment ...</span><br><span class="line">Clearing the configuration file: ./common/config/adminserver/env</span><br><span class="line">Clearing the configuration file: ./common/config/ui/env</span><br><span class="line">Clearing the configuration file: ./common/config/ui/app.conf</span><br><span class="line">Clearing the configuration file: ./common/config/ui/private_key.pem</span><br><span class="line">Clearing the configuration file: ./common/config/db/env</span><br><span class="line">Clearing the configuration file: ./common/config/jobservice/env</span><br><span class="line">Clearing the configuration file: ./common/config/jobservice/config.yml</span><br><span class="line">Clearing the configuration file: ./common/config/registry/config.yml</span><br><span class="line">Clearing the configuration file: ./common/config/registry/root.crt</span><br><span class="line">Clearing the configuration file: ./common/config/registryctl/env</span><br><span class="line">Clearing the configuration file: ./common/config/registryctl/config.yml</span><br><span class="line">Clearing the configuration file: ./common/config/nginx/nginx.conf</span><br><span class="line">Clearing the configuration file: ./common/config/log/logrotate.conf</span><br><span class="line">loaded secret from file: /data/secretkey</span><br><span class="line">Generated configuration file: ./common/config/nginx/nginx.conf</span><br><span class="line">Generated configuration file: ./common/config/adminserver/env</span><br><span class="line">Generated configuration file: ./common/config/ui/env</span><br><span class="line">Generated configuration file: ./common/config/registry/config.yml</span><br><span class="line">Generated configuration file: ./common/config/db/env</span><br><span class="line">Generated configuration file: ./common/config/jobservice/env</span><br><span class="line">Generated configuration file: ./common/config/jobservice/config.yml</span><br><span class="line">Generated configuration file: ./common/config/log/logrotate.conf</span><br><span class="line">Generated configuration file: ./common/config/registryctl/env</span><br><span class="line">Generated configuration file: ./common/config/ui/app.conf</span><br><span class="line">Generated certificate, key file: ./common/config/ui/private_key.pem, cert file: ./common/config/registry/root.crt</span><br><span class="line">The configuration files are ready, please use docker-compose to start the service.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[Step 2]: checking existing instance of Harbor ...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[Step 3]: starting Harbor ...</span><br><span class="line">Creating network &quot;harbor_harbor&quot; with the default driver</span><br><span class="line">Pulling log (goharbor/harbor-log:v1.6.0)...</span><br><span class="line">Trying to pull repository docker.io/goharbor/harbor-log ... </span><br><span class="line">v1.6.0: Pulling from docker.io/goharbor/harbor-log</span><br><span class="line">51be32cd3c9d: Pull complete</span><br><span class="line">fd9cdcfcef45: Pull complete</span><br><span class="line">4167b797c339: Pull complete</span><br><span class="line">b22d11b0e478: Pull complete</span><br><span class="line">d5aad3df7cee: Pull complete</span><br><span class="line">bd43de1bbd44: Pull complete</span><br><span class="line">7494eff3da48: Pull complete</span><br><span class="line">Digest: sha256:27f9e24f28393a6052b71c93b1571f2269e1d3c489f4081996a099ac88ff56ff</span><br><span class="line">Status: Downloaded newer image for docker.io/goharbor/harbor-log:v1.6.0</span><br><span class="line">Pulling postgresql (goharbor/harbor-db:v1.6.0)...</span><br><span class="line">Trying to pull repository docker.io/goharbor/harbor-db ... </span><br><span class="line">v1.6.0: Pulling from docker.io/goharbor/harbor-db</span><br><span class="line">51be32cd3c9d: Already exists</span><br><span class="line">16bdbb239be8: Pull complete</span><br><span class="line">1f2308455a1a: Pull complete</span><br><span class="line">886c09e06dee: Pull complete</span><br><span class="line">4c74f43fb3f6: Pull complete</span><br><span class="line">a5a85370032d: Pull complete</span><br><span class="line">c393ddbdd7fb: Pull complete</span><br><span class="line">ae546b8414b0: Pull complete</span><br><span class="line">Digest: sha256:ee65d512c93860bd4872be296de80c079842a64e2a4002360e720222a87ec346</span><br><span class="line">Status: Downloaded newer image for docker.io/goharbor/harbor-db:v1.6.0</span><br><span class="line">Pulling redis (goharbor/redis-photon:v1.6.0)...</span><br><span class="line">Trying to pull repository docker.io/goharbor/redis-photon ... </span><br><span class="line">v1.6.0: Pulling from docker.io/goharbor/redis-photon</span><br><span class="line">51be32cd3c9d: Already exists</span><br><span class="line">c400e93ba418: Pull complete</span><br><span class="line">170ae129f67d: Pull complete</span><br><span class="line">bffa31ec55cd: Pull complete</span><br><span class="line">5b72a97a5506: Pull complete</span><br><span class="line">Digest: sha256:4095dc26d6331b4d3c25377bc02d95501c51fbba99f31f9761d321bbc17803af</span><br><span class="line">Status: Downloaded newer image for docker.io/goharbor/redis-photon:v1.6.0</span><br><span class="line">Pulling adminserver (goharbor/harbor-adminserver:v1.6.0)...</span><br><span class="line">Trying to pull repository docker.io/goharbor/harbor-adminserver ... </span><br><span class="line">v1.6.0: Pulling from docker.io/goharbor/harbor-adminserver</span><br><span class="line">51be32cd3c9d: Already exists</span><br><span class="line">a12ecf0fa8fc: Pull complete</span><br><span class="line">3757394ad64f: Pull complete</span><br><span class="line">26ceec7e26ff: Pull complete</span><br><span class="line">e8d90789101d: Pull complete</span><br><span class="line">Digest: sha256:c3ca012c2d69099ba4e3bbedc58ffe146fd10aa5129d44cc7d735edf6167959e</span><br><span class="line">Status: Downloaded newer image for docker.io/goharbor/harbor-adminserver:v1.6.0</span><br><span class="line">Pulling registry (goharbor/registry-photon:v2.6.2-v1.6.0)...</span><br><span class="line">Trying to pull repository docker.io/goharbor/registry-photon ... </span><br><span class="line">v2.6.2-v1.6.0: Pulling from docker.io/goharbor/registry-photon</span><br><span class="line">51be32cd3c9d: Already exists</span><br><span class="line">eaf5637d77d9: Pull complete</span><br><span class="line">c68621c7e44d: Pull complete</span><br><span class="line">314e16c23f49: Pull complete</span><br><span class="line">e3f6c59a8a19: Pull complete</span><br><span class="line">e4f08365b84c: Pull complete</span><br><span class="line">29c822b725fa: Pull complete</span><br><span class="line">Digest: sha256:070dcc29fb5b34cdcc982394ead57f598160fd61bd8daee4b2a5f39ea37bd7a0</span><br><span class="line">Status: Downloaded newer image for docker.io/goharbor/registry-photon:v2.6.2-v1.6.0</span><br><span class="line">Pulling ui (goharbor/harbor-ui:v1.6.0)...</span><br><span class="line">Trying to pull repository docker.io/goharbor/harbor-ui ... </span><br><span class="line">v1.6.0: Pulling from docker.io/goharbor/harbor-ui</span><br><span class="line">51be32cd3c9d: Already exists</span><br><span class="line">ec6a6b245304: Pull complete</span><br><span class="line">a88d6c453ccb: Pull complete</span><br><span class="line">d5e2e9e0086a: Pull complete</span><br><span class="line">f8d7e9d8512c: Pull complete</span><br><span class="line">a06b1a705b19: Pull complete</span><br><span class="line">Digest: sha256:de332db437b8df6ce05203247cbf97ac9f4953672a8c22be8858aee47a0f435f</span><br><span class="line">Status: Downloaded newer image for docker.io/goharbor/harbor-ui:v1.6.0</span><br><span class="line">Pulling jobservice (goharbor/harbor-jobservice:v1.6.0)...</span><br><span class="line">Trying to pull repository docker.io/goharbor/harbor-jobservice ... </span><br><span class="line">v1.6.0: Pulling from docker.io/goharbor/harbor-jobservice</span><br><span class="line">51be32cd3c9d: Already exists</span><br><span class="line">ffcdeda0f50f: Pull complete</span><br><span class="line">e69daf7ff175: Pull complete</span><br><span class="line">840fbfb5576e: Pull complete</span><br><span class="line">Digest: sha256:51d2bf14cd9d1bbf082793a0556ff949937655c67569a86424210a1455f60057</span><br><span class="line">Status: Downloaded newer image for docker.io/goharbor/harbor-jobservice:v1.6.0</span><br><span class="line">Pulling proxy (goharbor/nginx-photon:v1.6.0)...</span><br><span class="line">Trying to pull repository docker.io/goharbor/nginx-photon ... </span><br><span class="line">v1.6.0: Pulling from docker.io/goharbor/nginx-photon</span><br><span class="line">51be32cd3c9d: Already exists</span><br><span class="line">edc138fa5ed7: Pull complete</span><br><span class="line">Digest: sha256:3270c6fc3bdaaecd16280592e916e2cfcf7c5eb54ffc46d79b507b625e3fb4c6</span><br><span class="line">Status: Downloaded newer image for docker.io/goharbor/nginx-photon:v1.6.0</span><br><span class="line">Creating harbor-log ... done</span><br><span class="line">Creating redis              ... done</span><br><span class="line">Creating harbor-adminserver ... done</span><br><span class="line">Creating registry           ... done</span><br><span class="line">Creating harbor-db          ... done</span><br><span class="line">Creating harbor-ui          ... done</span><br><span class="line">Creating harbor-jobservice  ... done</span><br><span class="line">Creating nginx              ... done</span><br><span class="line"></span><br><span class="line">✔ ----Harbor has been installed and started successfully.----</span><br><span class="line"></span><br><span class="line">Now you should be able to visit the admin portal at http://192.168.2.46 . </span><br><span class="line">For more details, please visit https://github.com/goharbor/harbor .</span><br></pre></td></tr></table></figure>
<h4 id="5-3-使用harbor"><a href="#5-3-使用harbor" class="headerlink" title="5.3 使用harbor"></a>5.3 使用harbor</h4><blockquote>
<p>web访问：<a href="http://192.168.2.46" target="_blank" rel="noopener">http://192.168.2.46</a> 客户端若使用harbor仓库则需进行如下配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#修改配置文件</span><br><span class="line">[root@localhost ~]# cat /etc/docker/daemon.json </span><br><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;https://docker.mirrors.ustc.edu.cn&quot;],</span><br><span class="line">  &quot;insecure-registries&quot;: [&quot;192.168.2.46&quot;]</span><br><span class="line">&#125;</span><br><span class="line">#重启docker服务</span><br><span class="line">[root@localhost ~]# systemctl restart docker</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h5 id="5-3-1-push镜像至harbor中"><a href="#5-3-1-push镜像至harbor中" class="headerlink" title="5.3.1 push镜像至harbor中"></a>5.3.1 push镜像至harbor中</h5><h6 id="5-3-1-1-登陆"><a href="#5-3-1-1-登陆" class="headerlink" title="5.3.1.1 登陆"></a>5.3.1.1 登陆</h6><center> <img src="https://i.loli.net/2018/10/23/5bcea9c0e6928.png" alt="03.png" title="03.png"> </center>

<h6 id="5-3-1-2-push镜像"><a href="#5-3-1-2-push镜像" class="headerlink" title="5.3.1.2 push镜像"></a>5.3.1.2 push镜像</h6><p>若为从其他地方pull的镜像需要修改tag<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker tag centos:latest 192.168.2.46/library/centos:latest</span><br><span class="line">docker push 192.168.2.46/library/centos:latest</span><br></pre></td></tr></table></figure></p>
<h5 id="5-3-2-客户端pull镜像"><a href="#5-3-2-客户端pull镜像" class="headerlink" title="5.3.2 客户端pull镜像"></a>5.3.2 客户端pull镜像</h5><h6 id="5-3-2-1-客户端从服务器中拉取镜像"><a href="#5-3-2-1-客户端从服务器中拉取镜像" class="headerlink" title="5.3.2.1 客户端从服务器中拉取镜像"></a>5.3.2.1 客户端从服务器中拉取镜像</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">命令如下：docker pull 192.168.2.46/library/zabbix2.4.8:v1.0</span><br></pre></td></tr></table></figure>
<center> <img src="https://i.loli.net/2018/10/23/5bcea8312b5c5.png" alt="01.png" title="01.png"> </center>

<h6 id="5-3-2-2-查看此客户端的镜像"><a href="#5-3-2-2-查看此客户端的镜像" class="headerlink" title="5.3.2.2 查看此客户端的镜像"></a>5.3.2.2 查看此客户端的镜像</h6><center> <img src="https://i.loli.net/2018/10/23/5bcea831655f6.png" alt="02.png" title="02.png"></center>


<h3 id="6-常见错误："><a href="#6-常见错误：" class="headerlink" title="6 常见错误："></a>6 常见错误：</h3><h4 id="6-1-问题1："><a href="#6-1-问题1：" class="headerlink" title="6.1 问题1："></a>6.1 问题1：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#问题描述：</span><br><span class="line">使用systemctl start sshd 执行报错Failed to get D-Bus connection: Operation not permitted解决</span><br><span class="line">#解决方法：</span><br><span class="line">启动容器时需要使用docker run -tdi --privileged centos /usr/sbin/init，这样就不能使用docker attach进入容器操作命令了，需要使用docker exec -it zabbix-server /bin/bash</span><br></pre></td></tr></table></figure>
<p>docker run -itd –restart=always -v /etc/sftp.conf:/etc/sftp/users.conf:ro -v /mvtech/sftp_root:/home –privileged -p 3333:22 –name=sftp docker.io/atmoz/sftp</p>
<h3 id="制作图片视频程序镜像"><a href="#制作图片视频程序镜像" class="headerlink" title="制作图片视频程序镜像"></a>制作图片视频程序镜像</h3><p>docker run -itd –restart=always –network host  –privileged –name=pic 211.103.227.138:24980/library/centos7_zh_jdk8 /usr/sbin/init<br>-v /mvtech/picsort /mvtech/picsort </p>
<p>cd /mvtech/python/check_text &amp;&amp; python3 check_text.py &amp;<br>cd /mvtech/python/check_text &amp;&amp; python3 check_text.py &amp;<br>cd /mvtech/python/picscanner180228 &amp;&amp; python monitor_image.py &amp;<br>python3 check_text.py &amp;[</p>
<p>docker run -itd –restart=always -v /mvtech/picsort /mvtech/picsort –privileged –name=pic 211.103.227.138:24980/mvtech/pic /usr/sbin/init<br>-v /mvtech/picsort /mvtech/picsort </p>
<p> docker run -d -it –name=”eu_wz” –hostname=”EU-WZ” –memory=”40960m” –mac-address=”aa:bb:cc:04:28:01” –memory-swap=”-1” –env=”LANG=en_US.UTF-8” –env=”JAVA_HOME=/mvtech/apps/java” –env=”JRE_HOME=/mvtech/apps/java/jre” –env=”CLASSPATH=/mvtech/apps/java/lib:/mvtech/apps/java/jre/lib” –env=”PATH=/mvtech/apps/java/bin:/mvtech/apps/java/jre/bin:/mvtech/apps/java:/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/root/bin” –volume=”/etc/localtime:/etc/localtime:ro” –volume=”/mvtech/apps/java:/mvtech/apps/java:ro” –volume=”/mvtech/apps/docker/eu_wz:/mvtech/apps/isms-backend:ro” –volume=”/mvtech/data/vsftp/eu_wz/:/mvtech/data” –volume=”/mvtech/work/docker/eu_wz/:/mvtech/work” –volume=”/mvtech/logs/docker/eu_wz/:/mvtech/logs” –workdir=”/mvtech” isms-backend:1.0 /bin/bash</p>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2018-12-18</span><i class="fa fa-tag"></i><a class="tag" href="/tags/docker/" title="docker">docker </a></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank"></a></div><div class="weibo"><a class="fa fa-weibo" href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));"></a></div><div class="twitter"><a class="fa fa-twitter" href="http://twitter.com/home?status=,https://sdhzdtwhm.github.io/2018/12/18/docker入门指南/,杨航的博客,docker入门指南,;"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/2018/12/18/CDH5.11.2快速配置文档/" title="cdh5.11.2快速配置文档">上一篇</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/2018/12/18/MHA入门实战/" title="mha入门实战">下一篇</a></li></ul></div></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>